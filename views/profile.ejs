<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>사용자 프로필</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="/public/css/profile.css">
</head>

<body>
    <div class="header">
        <div class="header-content">
            <div class="header-title">
                사용자 프로필
            </div>
            <div class="profile-edit-button">
                <i class="fas fa-cog" alt="프로필 수정"></i>
            </div>
        </div>
    </div>

    <!-- 중앙 사용자 정보 섹션 -->
    <div class="user-info">
        <!-- 좌측 프로필 사진 및 닉네임 -->
        <div class="left-section">
            <div class="profile-picture">
                <img src="" alt="프로필 사진">
            </div>
            <div class="user-nickname">
                <h1>
                    <%= user.nickname %>
                </h1>
            </div>
        </div>
        <!-- 우측 사용자 정보 -->
        <div class="right-section">
            <p>ID: <%= user.login_id %>
            </p>
            <p>나이: <%= age %>
            </p>
            <p>성별: <%= user.gender %>
            </p>
            <p>생년월일: <%= user.birth %>
            </p>
            <p>이메일: <%= user.email %>
            </p>
        </div>
    </div>

    <div class="friend-info">
        <!-- 친구 수 및 버튼 -->
        <p class="friend-count">친구 수: <%= friendCount %>
        </p>
        <button><i class="fas fa-plus"></i> 게시물 작성</button>
    </div>

    <div class="bottom-section">
        <!-- 채팅방 목록 -->
        <div class="category">
            <button class="category-button" onclick="toggleCategory('chatRoomsList')">내 채팅방</button>
            <div id="chatRoomsList">
                <!-- 내가 개설한 채팅방 목록 -->
                <ul class="category-list">
                    <li class="category-title">내가 개설한 채팅방</li>
                    <% if (ownerChatRooms.length===0) { %>
                        <li class="empty-message">내가 개설한 방이 없어요</li>
                        <% } else { %>
                            <% ownerChatRooms.forEach(function(room) { %>
                                <li>
                                    <a href="/chat/<%= room.id %>">
                                        <%= room.name %> (<%= room.unreadMessages %> 안 읽은 메시지)
                                                <% if (room.latestUnreadMessage) { %>
                                                    <span class="latest-message">
                                                        <%= room.latestUnreadMessage.message %>
                                                    </span>
                                                    <% } %>
                                    </a>
                                </li>
                                <% }); %>
                                    <% } %>
                </ul>

                <!-- 내가 참여한 채팅방 목록 -->
                <ul class="category-list">
                    <li class="category-title">내가 참여한 채팅방</li>
                    <% if (userChatRooms.length===0) { %>
                        <li class="empty-message">내가 참여한 방이 없어요</li>
                        <% } else { %>
                            <% userChatRooms.forEach(function(room) { %>
                                <li>
                                    <a href="/chat/<%= room.id %>">
                                        <%= room.name %> (<%= room.unreadMessages %> 안 읽은 메시지)
                                                <% if (room.latestUnreadMessage) { %>
                                                    <span class="latest-message">
                                                        <%= room.latestUnreadMessage.message %>
                                                    </span>
                                                    <% } %>
                                    </a>
                                </li>
                                <% }); %>
                                    <% } %>
                </ul>
            </div>
        </div>


        <!-- 북마크한 게시물 목록 -->
        <div class="category">
            <button class="category-button" onclick="toggleCategory(this)">북마크한 게시물</button>
            <ul class="category-list">
                <% bookmarkedBoards.forEach(function(board) { %>
                    <li><a href="/board/<%= board.id %>">
                            <%= board.title %>
                        </a></li>
                    <% }); %>
            </ul>
        </div>

        <!-- 일정 목록 -->
        <div class="category">
            <button class="category-button" onclick="toggleCategory(this)">일정</button>
            <ul class="category-list">
                <% schedules.forEach(function(schedule) { %>
                    <li>
                        <%= schedule.title %>: <%= schedule.date %>
                    </li>
                    <% }); %>
            </ul>
        </div>
    </div>

    <script>
        console.log('button',document.querySelector('.profile-edit-button'));
        // 프로필 수정 버튼 클릭 시 이벤트
        document.querySelector('.profile-edit-button').addEventListener('click', function () {
            // 프로필 수정 페이지로 이동 (URL을 수정 페이지의 경로로 변경)
            window.location.href = '/profile/edit';
        });

        // 게시물 작성 버튼 클릭 시 이벤트 처리
        document.querySelector('.friend-info button').addEventListener('click', function () {
            // 게시물 작성 페이지로 이동 (URL을 /new로 변경)
            window.location.href = '/new';
        });

        // 카테고리 버튼 클릭 시 목록 펼치기/닫기 이벤트
        const categoryButtons = document.querySelectorAll('.category-button');
        categoryButtons.forEach(function (button) {
            button.addEventListener('click', function () {
                // 다른 모든 카테고리를 닫고 현재 클릭한 카테고리만 열기
                categoryButtons.forEach(function (btn) {
                    // 이전에 열린 카테고리 닫기
                    btn.nextElementSibling.style.display = 'none';
                });

                // 클릭한 버튼에 대응하는 카테고리 목록 열기
                const targetId = this.getAttribute('data-target');
                if (targetId) {
                    const targetList = document.getElementById(targetId);
                    if (targetList) {
                        targetList.style.display = 'block';
                    }
                }
            });
        });

        // 내 채팅방 버튼 클릭 시 이벤트
        document.querySelector('.category-button[data-category="chatRoomsList"]').addEventListener('click', function () {
            // 채팅방 목록 div
            const chatRoomsList = document.getElementById('chatRoomsList');

            // 채팅방 목록을 표시
            if (chatRoomsList) {
                chatRoomsList.style.display = 'block';
            }
        });
    </script>
</body>

</html>