<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>사용자 프로필</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="/public/css/profile.css">
    <link rel="stylesheet" href="/public/css/board/board_list.css">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>

<body>
    <div class="header">
        <div class="header-content">
            <div class="header-title">
                사용자 프로필
            </div>
            <div class="profile-edit-button">
                <i class="fas fa-cog" alt="프로필 수정"></i>
            </div>
        </div>
    </div>

    <!-- 중앙 사용자 정보 섹션 -->
    <div class="user-info">
        <!-- 좌측 프로필 사진 및 닉네임 -->
        <div class="left-section">
            <div class="profile-picture">
                <img src="<%= profileImage %>" alt="프로필 사진">
            </div>
            <div class="user-nickname">
                <h1>
                    <%= user.nickname %>
                </h1>
            </div>
        </div>
        <!-- 우측 사용자 정보 -->
        <div class="right-section">
            <p>ID: <%= user.login_id %>
            </p>
            <p>나이: <%= age %>
            </p>
            <p>성별: <%= user.gender %>
            </p>
            <p>생년월일: <%= user.birth %>
            </p>
            <p>이메일: <%= user.email %>
            </p>
        </div>
    </div>

    <div class="friend-info">
        <!-- 친구 수 및 버튼 -->
        <p class="friend-count">친구 수: <%= friendCount %>
        </p>
        <button><i class="fas fa-plus"></i> 게시물 작성</button>
    </div>

    
    <div class="bottom-section">
        <div class="categories-container">
            <!-- 채팅방 버튼 -->
            <div class="category">
                <button class="category-button" id="chatButton">내 채팅방</button>
            </div>
            <!-- 북마크한 게시물 버튼 -->
            <div class="category">
                <button class="category-button" id="bookmarkButton" onclick="getbaordPagenation()">북마크한 게시물</button>
            </div>
            <!-- 일정 버튼 -->
            <div class="category">
                <button class="category-button" id="scheduleButton">일정</button>
            </div>
        </div>

        <!-- 카테고리에 따른 목록 -->
        <div class="list-container" id="chatList">
            <!-- 채팅방 목록 -->
            <div class="category-list">
                <ul>
                    <li class="category-title">내가 개설한 채팅방</li>
                    <% if (posterChatRooms.length === 0) { %>
                    <li class="empty-message">내가 개설한 방이 없어요</li>
                    <% } else { %>
                    <% posterChatRooms.forEach(function(room) { %>
                    <li>
                        <a href="/chat?<%= room.room_id %>">
                            <%= room.title %> (<%= room.unreadMessages %> 안 읽은 메시지)
                            <% if (room.latestUnreadMessage) { %>
                            <span class="latest-message">
                                <%= room.latestUnreadMessage.message %>
                            </span>
                            <% } %>
                        </a>
                    </li>
                    <% }); %>
                    <% } %>
                </ul>
                <!-- 내가 참여한 채팅방 목록 -->
                <ul>
                    <li class="category-title">내가 참여한 채팅방</li>
                    <!-- 내가 참여한 채팅방 목록 내용... -->
                    <% if (userChatRooms.length === 0) { %>
                    <li class="empty-message">내가 참여한 방이 없어요</li>
                    <% } else { %>
                    <% userChatRooms.forEach(function(room) { %>
                    <li>
                        <a href="/chat?<%= room.room_id %>">
                            <%= room.title %> (<%= room.unreadMessages %> 안 읽은 메시지)
                            <% if (room.latestUnreadMessage) { %>
                            <span class="latest-message">
                                <%= room.latestUnreadMessage.message %>
                            </span>
                            <% } %>
                        </a>
                    </li>
                    <% }); %>
                    <% } %>
                </ul>
            </div>
        </div>
        <div class="wrap" id="wrap"> </div>
        <div class="list-container" id="bookmarkList">
            <!-- 북마크한 게시물 목록 -->
            <div class="category-list">
                <!-- <button type="button" onclick="getbaordPagenation()">버튼</button> -->
                
                <ul>
                    <% if (bookmarkedBoards.length === 0) { %>
                    <li>북마크한 게시물이 없어요</li>
                    <% } else { %>
                    <% bookmarkedBoards.forEach(function(board) { %>
                    <% if (board && board.id) { %>
                    <li><a href="/board/<%= board.id %>">
                            <%= board.title %>
                        </a></li>
                    <% } %>
                    <% }); %>
                    <% } %>
                </ul>
            </div>
        </div>

        <!-- 일정 목록 -->
        <div class="list-container" id="scheduleList">
            <div class="category-list">
                <ul>
                    <% if (schedules.length === 0) { %>
                    <li>저장된 일정이 없어요</li>
                    <% } else { %>
                    <% schedules.forEach(function(schedule) { %>
                    <li>
                        <%= schedule.title %>: <%= schedule.date %>
                    </li>
                    <% }); %>
                    <% } %>
                </ul>
            </div>
        </div>
    </div>
    </div>
    <script src="/public/js/index.js" defer></script>
    <script src="/public/js/board/board_CRUD.js"></script>
    <script>

    let list = [];
    async function getbaordPagenation(){       
    try {

    // const findAllData = await findall_profile_bookmark(3);
    // console.log("findAllData",findAllData);
    const findAllData_board = await findall_profile_bookmark_board();
        if (findAllData_board.length > 0) {
            const wrap = document.querySelector("#wrap");

            let boxhtml = ``;

            for (let i=0; i<findAllData_board.length; i++){
                let date = new Date(`${findAllData_board[i].createdAt}`);
                list.push(findAllData_board[i]);
                const data = {
                    category : findAllData_board[i] && findAllData_board[i].board.category ? findAllData_board[i].board.category : '',
                    title :  findAllData_board[i] && findAllData_board[i].board.title ? findAllData_board[i].board.title : '',
                    views : findAllData_board[i] && findAllData_board[i].views ? findAllData_board[i].views : 0,
                    createAt: `${date.getFullYear()}-${(date.getMonth() + 1)>= 10 ? (date.getMonth() + 1) : '0' + (date.getMonth() + 1) }-${date.getDate() >= 10 ? date.getDate() : '0' + date.getDate()} ${date.getHours()}시`
                }
                if(i%2==0){
                    boxhtml += `
                <div class="imgFlex1" onclick="loadDetailModal(${i})">
                    <div class="roomImg"></div>
                    <div class="boardInfo">
                        <div class="boxBordCategory">${data.category}</div>
                        <div class="boxTitle">${data.title}</div><br>
                        <div class="boxCreateAt">${data.createAt}</div>
                        <div class="boxViews"><img src="https://kdt9-justin.s3.ap-northeast-2.amazonaws.com/viewicon.png" style="width: 20px; position: relative; top: 5px" >${data.views}</div>      
                    </div>
                </div>
                `;  
                } else{
                    boxhtml += `
                <div class="imgFlex2" onclick="loadDetailModal(${i})">
                    <div class="roomImg"></div>
                    <div class="boardInfo">
                        <div class="boxBordCategory">${data.category}</div>
                        <div class="boxTitle">${data.title}</div><br>
                        <div class="boxCreateAt">${data.createAt}</div>
                        <div class="boxViews"><img src="https://kdt9-justin.s3.ap-northeast-2.amazonaws.com/viewicon.png" style="width: 20px; position: relative; top: 5px" >${data.views}</div>      
                    </div>
                </div>
                `;  
                }
                if (findAllData_board.length === i + 1) {
                    page_id = findAllData_board[i].id + 1;
                }

            }
        wrap.innerHTML += boxhtml;
    }

} catch (e) {
}
}
    
    </script>

    <script src="/public/js/profile.js"></script>

</body>

</html>